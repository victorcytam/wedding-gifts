<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hannah & Victor 22.11.2025</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      background: linear-gradient(to bottom, #fffaf0, #fdf2e9); 
      margin:0; padding:0; min-height:100vh; 
    }
    .container { max-width: 100%; margin: 0 auto; padding: 20px 15px; }
    h1 { text-align:center; color:#c0392b; font-size:28px; margin:20px 0 8px; font-weight:600; }
    .date { text-align:center; color:#e74c3c; font-size:19px; margin-bottom:25px; letter-spacing:1px; }
    .thanks {
      background:#fff; padding:22px; border-radius:18px; box-shadow:0 10px 30px rgba(0,0,0,0.08);
      margin:20px 0; text-align:center; line-height:1.9; font-size:16px; color:#2c3e50;
    }
    .thanks strong { color:#c0392b; font-size:19px; }

    .gift { 
      border-radius:18px; padding:18px; margin:18px 0; display:flex; align-items:center;
      background:#fff; box-shadow:0 8px 25px rgba(0,0,0,0.09); transition:all 0.2s;
    }
    .gift:active { transform:scale(0.98); }
    .gift img { 
      width:96px; height:96px; object-fit:cover; border-radius:15px; margin-right:16px; 
      flex-shrink:0; background:#f0f0f0;
    }
    .gift .info { flex:1; }
    .gift .price { font-weight:bold; color:#27ae60; font-size:19px; }
    .gift button { 
      background:#e74c3c; color:white; border:none; padding:13px 24px; 
      border-radius:50px; cursor:pointer; font-size:15px; font-weight:500; min-width:120px;
    }
    .gift button:active { background:#c0392b; }

    .redpocket { border: 3px solid #e74c3c !important; background: linear-gradient(135deg, #fff9f9, #fff3f3) !important; }

    .modal-content { border-radius:22px; padding:28px; max-width:90%; text-align:center; position:relative; }
    .qr { width:240px; margin:20px auto; border:10px solid #fff; border-radius:18px; box-shadow:0 6px 25px rgba(0,0,0,0.15); display:none; }
    .qr.active { display:block; }
    .payment-btns { display:flex; gap:15px; justify-content:center; margin:20px 0; display:none; }
    .btn-fps { background:#1e90ff; color:white; padding:14px 28px; border-radius:50px; font-size:16px; border:none; flex:1; }
    .btn-payme { background:#e74c3c; color:white; padding:14px 28px; border-radius:50px; font-size:16px; border:none; flex:1; }
    #confirm-btn { background:#27ae60; padding:15px 32px; border-radius:50px; font-size:17px; width:100%; margin-top:20px; display:none; }

    #proceed-btn { background:#9b59b6; color:white; padding:15px 32px; border-radius:50px; font-size:17px; width:100%; margin-top:25px; }

    .input-group { display:none; margin-top:20px; }
    .input-group input, .input-group textarea {
      width:100%; padding:16px; margin:10px 0; border-radius:50px; border:1px solid #ddd; text-align:center; font-size:16px;
    }
    .input-group textarea { height:100px; resize:none; border-radius:20px; text-align:left; padding:16px; }

    .admin-btn { margin:70px auto 40px; text-align:center; }
    .admin-btn button { background:#2c3e50; padding:11px 18px; border-radius:50px; font-size:12px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Hannah & Victor</h1>
    <div class="date">22 November 2025</div>

    <div class="thanks">
      <strong>親愛的家人朋友，</strong><br><br>
      感謝你們來到我們人生中最重要的一天！有你哋在場已經係最好嘅禮物～<br><br>
      Your presence is the greatest blessing. 如果你哋想再送上祝福，<br>
      以下係我哋用心準備嘅禮物清單同利是選項，隨心選擇即可<br><br>
      多謝你哋嘅愛心同支持，真係好感動！感恩有你哋！
    </div>

    <h2 style="color:#e74c3c; text-align:center; margin:40px 0 20px;">Available Gifts 可選禮物</h2>
    <div id="available"></div>

    <h2 style="color:#27ae60; text-align:center; margin:50px 0 20px;">Already Gifted 已送出嘅祝福</h2>
    <div id="gifted"></div>

    <!-- Claim Modal -->
    <div id="modal" class="modal">
      <div class="modal-content">
        <span class="close">×</span>
        <img id="modal-img" src="" alt="" style="width:100px;height:100px;object-fit:cover;border-radius:15px;margin-bottom:15px;" />
        <h3 id="modal-name" style="margin:15px 0 8px; font-size:20px;"></h3>
        <p id="modal-details" style="color:#555; margin:15px 0; line-height:1.7; font-size:15px; white-space:pre-line;"></p>
        <p style="font-size:21px; color:#27ae60; margin:15px 0;">
          <span id="modal-price"></span>
        </p>

        <button id="proceed-btn" onclick="showPaymentOptions()">Proceed to Pay</button>

        <!-- Hidden until Proceed -->
        <div class="payment-btns" id="payment-btns">
          <button class="btn-fps" onclick="showQR('fps')">FPS</button>
          <button class="btn-payme" onclick="showQR('payme')">PayMe</button>
        </div>

        <img id="qr-fps" src="images/qr-fps.png" alt="FPS QR" class="qr" />
        <img id="qr-payme" src="images/qr-payme.png" alt="PayMe QR" class="qr" />

        <div class="input-group" id="input-group">
          <input type="text" id="claimer-name" placeholder="Your name 你的名字" required />
          <textarea id="blessing" placeholder="Leave a blessing for us... 留句祝福俾我哋..."></textarea>
          <button id="confirm-btn">I've Paid – Record My Gift</button>
        </div>
      </div>
    </div>

    <!-- Admin Button -->
    <div class="admin-btn">
      <button onclick="openAdminPanel()">Undo a gift (admin only)</button>
    </div>

    <!-- Admin Modal -->
    <div id="admin-modal" class="modal" style="display:none;">
      <div class="modal-content" style="max-width:400px;">
        <h3 style="color:#c0392b;">Admin: Undo Gift</h3>
        <p>Password:</p>
        <input type="password" id="admin-pass" placeholder="Enter password" style="width:100%; padding:12px; border-radius:50px; text-align:center;" />
        <p>Select gift to undo:</p>
        <select id="gift-to-reset" style="width:100%; padding:12px; margin:15px 0; border-radius:50px;"></select>
        <div style="margin-top:20px;">
          <button onclick="performReset()" style="background:#27ae60; padding:12px 24px; border-radius:50px;">Confirm Undo</button>
          <button onclick="document.getElementById('admin-modal').style.display='none'" style="margin-left:10px; background:#95a5a6; padding:12px 20px; border-radius:50px;">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    function showPaymentOptions() {
      document.getElementById('proceed-btn').style.display = 'none';
      document.getElementById('payment-btns').style.display = 'flex';
      showQR('fps'); // default
    }

    function showQR(type) {
      document.getElementById('qr-fps').classList.remove('active');
      document.getElementById('qr-payme').classList.remove('active');
      document.getElementById('qr-' + type).classList.add('active');
      document.getElementById('input-group').style.display = 'block';
    }

    // Update modal with details
    const originalOpenModal = openModal;
    openModal = function(id) {
      currentGift = gifts.find(g => g.id === id);
      if (!currentGift || (!currentGift.isRedPocket && currentGift.claimed)) return;

      document.getElementById('modal-img').src = currentGift.photo;
      document.getElementById('modal-name').textContent = currentGift.name;
      document.getElementById('modal-price').textContent = 
        currentGift.isRedPocket ? 'Any amount 隨意金額' : 'HK$ ' + currentGift.price;
      document.getElementById('modal-details').textContent = currentGift.details || "Thank you for your love!";

      // Reset modal
      document.getElementById('proceed-btn').style.display = 'block';
      document.getElementById('payment-btns').style.display = 'none';
      document.getElementById('input-group').style.display = 'none';
      document.getElementById('qr-fps').classList.remove('active');
      document.getElementById('qr-payme').classList.remove('active');
      document.getElementById('claimer-name').value = '';
      document.getElementById('blessing').value = '';

      document.getElementById('modal').style.display = 'flex';
    };

    // Confirm button now saves name + blessing
    document.getElementById('confirm-btn').onclick = () => {
      const name = document.getElementById('claimer-name').value.trim();
      const blessing = document.getElementById('blessing').value.trim();
      if (!name) return alert('Please enter your name');

      const db = firebase.database();
      const data = { name, blessing: blessing || "No message" };
      const updates = {};
      updates[currentGift.id] = data;

      db.ref('weddingGifts').update(updates)
        .then(() => {
          alert(`Thank you ${name}! Your gift is recorded.`);
          document.getElementById('modal').style.display = 'none';
        })
        .catch(() => alert('Network error, please try again'));
    };
  </script>
</body>
</html>