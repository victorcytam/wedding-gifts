<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hannah & Victor's Wedding ♡ 22.11.2025</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      background: linear-gradient(to bottom, #fffaf0, #fdf2e9); 
      margin:0; padding:0; min-height:100vh; 
    }
    .container { max-width: 100%; margin: 0 auto; padding: 20px 15px; }
    h1 { text-align:center; color:#c0392b; font-size:28px; margin:20px 0 8px; font-weight:600; }
    .date { text-align:center; color:#e74c3c; font-size:19px; margin-bottom:25px; letter-spacing:1px; }
    .thanks {
      background:#fff; padding:22px; border-radius:18px; box-shadow:0 10px 30px rgba(0,0,0,0.08);
      margin:20px 0; text-align:center; line-height:1.9; font-size:16px; color:#2c3e50;
    }
    .thanks strong { color:#c0392b; font-size:19px; }

    .gift { 
      border-radius:18px; padding:18px; margin:18px 0; display:flex; align-items:center;
      background:#fff; box-shadow:0 8px 25px rgba(0,0,0,0.09); transition:all 0.2s;
    }
    .gift:active { transform:scale(0.98); }
    .gift img { 
      width:96px; height:96px; object-fit:cover; border-radius:15px; margin-right:16px; 
      flex-shrink:0; background:#f0f0f0;
    }
    .gift .info { flex:1; }
    .gift .price { font-weight:bold; color:#27ae60; font-size:19px; }
    .gift button { 
      background:#e74c3c; color:white; border:none; padding:13px 24px; 
      border-radius:50px; cursor:pointer; font-size:15px; font-weight:500; min-width:120px;
    }
    .gift button:active { background:#c0392b; }

    .redpocket { border: 3px solid #e74c3c !important; background: linear-gradient(135deg, #fff9f9, #fff3f3) !important; }

    .modal-content { border-radius:22px; padding:28px; max-width:90%; }
    .qr { width:220px; margin:20px auto; border:10px solid #fff; border-radius:15px; box-shadow:0 6px 20px rgba(0,0,0,0.15); }
    #confirm-btn { background:#27ae60; padding:15px 32px; border-radius:50px; font-size:17px; }

    .admin-btn { margin:70px auto 40px; text-align:center; }
    .admin-btn button { background:#2c3e50; padding:11px 18px; border-radius:50px; font-size:12px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Hannah & Victor</h1>
    <div class="date">22 November 2025 ♡</div>

    <div class="thanks">
      <strong>親愛的家人朋友，</strong><br><br>
      感謝你們來到我們人生中最重要的一天！有你哋在場已經係最好嘅禮物～<br><br>
      Your presence is the greatest blessing. 如果你哋想再送上祝福，<br>
      以下係我哋用心準備嘅禮物清單同利是選項，隨心選擇即可 ♡<br><br>
      多謝你哋嘅愛心同支持，真係好感動！感恩有你哋！
    </div>

    <h2 style="color:#e74c3c; text-align:center; margin:40px 0 20px;">Available Gifts 可選禮物</h2>
    <div id="available"></div>

    <h2 style="color:#27ae60; text-align:center; margin:50px 0 20px;">Already Gifted 已送出嘅祝福</h2>
    <div id="gifted"></div>

    <!-- Claim Modal -->
    <div id="modal" class="modal">
      <div class="modal-content">
        <span class="close">×</span>
        <img id="modal-img" src="" alt="" style="width:100px;height:100px;object-fit:cover;border-radius:15px;" />
        <h3 id="modal-name" style="margin:18px 0 10px; font-size:20px;"></h3>
        <p style="font-size:21px; color:#27ae60; margin:10px 0;">
          <span id="modal-price"></span>
        </p>
        <p style="margin:20px 0; color:#7f8c8d; font-size:15px;">
          Please pay via FPS → then enter your name ♡
        </p>
        <img src="images/qr-fps.png" alt="FPS QR" class="qr" />
        <input type="text" id="claimer-name" placeholder="Your name 你的名字" required 
               style="width:100%; padding:16px; margin:18px 0; border-radius:50px; border:1px solid #ddd; text-align:center; font-size:17px;" />
        <button id="confirm-btn">I've Paid – Claim This Gift</button>
      </div>
    </div>

    <!-- Admin Button -->
    <div class="admin-btn">
      <button onclick="openAdminPanel()">Undo a gift (admin only)</button>
    </div>

    <!-- Admin Modal -->
    <div id="admin-modal" class="modal" style="display:none;">
      <div class="modal-content" style="max-width:400px;">
        <h3 style="color:#c0392b;">Admin: Undo Gift</h3>
        <p>Password:</p>
        <input type="password" id="admin-pass" placeholder="Enter password" style="width:100%; padding:12px; border-radius:50px; text-align:center;" />
        <p>Select gift to undo:</p>
        <select id="gift-to-reset" style="width:100%; padding:12px; margin:15px 0; border-radius:50px;"></select>
        <div style="margin-top:20px;">
          <button onclick="performReset()" style="background:#27ae60; padding:12px 24px; border-radius:50px;">Confirm Undo</button>
          <button onclick="document.getElementById('admin-modal').style.display='none'" style="margin-left:10px; background:#95a5a6; padding:12px 20px; border-radius:50px;">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    let gifts = [];
    let claimedHistory = JSON.parse(localStorage.getItem('weddingGifts_v2') || '{}');

    fetch('gifts.json')
      .then(r => r.json())
      .then(data => {
        gifts = data;
        loadClaims();
        render();
      });

    function loadClaims() {
      gifts.forEach(g => {
        if (!g.isRedPocket && claimedHistory[g.id]) {
          g.claimed = true;
          g.claimedBy = claimedHistory[g.id];
        }
      });
    }

    function saveToStorage() {
      const map = {};
      gifts.forEach(g => {
        if (!g.isRedPocket && g.claimed) map[g.id] = g.claimedBy;
      });
      localStorage.setItem('weddingGifts_v2', JSON.stringify(map));
    }

    function render() {
      const available = gifts.filter(g => g.isRedPocket || !g.claimed);
      const gifted    = gifts.filter(g => g.claimed || (g.isRedPocket && claimedHistory[g.id]));

      document.getElementById('available').innerHTML = available.map(giftCard).join('');
      document.getElementById('gifted').innerHTML     = gifted.map(giftedCard).join('');
    }

    function giftCard(g) {
      const rpClass = g.isRedPocket ? 'gift redpocket' : 'gift';
      const priceText = typeof g.price === 'number' ? `HK$ ${g.price}` : g.price;
      return `
        <div class="${rpClass}">
          <img src="${g.photo}" alt="${g.name}" onerror="this.src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGAo9W5xwAAAABJRU5ErkJggg=='">
          <div class="info">
            <strong>${g.name}</strong><br>
            <span class="price">${priceText}</span>
          </div>
          <button onclick="openModal(${g.id})">${g.isRedPocket ? 'Send 利是 ♡' : "I'll give this"}</button>
        </div>`;
    }

    function giftedCard(g) {
      const by = claimedHistory[g.id] || g.claimedBy || 'Anonymous';
      return `
        <div class="gift" style="opacity:0.9; border:2px solid #27ae60;">
          <img src="${g.photo}" alt="${g.name}">
          <div class="info">
            <strong>${g.name}</strong><br>
            <em style="color:#27ae60;">♥ Gifted by ${by}</em>
          </div>
        </div>`;
    }

    let currentGift = null;
    function openModal(id) {
      currentGift = gifts.find(g => g.id === id);
      if (!currentGift) return;

      document.getElementById('modal-img').src = currentGift.photo;
      document.getElementById('modal-name').textContent = currentGift.name;
      document.getElementById('modal-price').textContent = 
        currentGift.isRedPocket ? 'Any amount ♡ 隨意金額' : 'HK$ ' + currentGift.price;
      document.getElementById('claimer-name').value = '';
      document.getElementById('modal').style.display = 'flex';
    }

    document.querySelector('.close').onclick = () => document.getElementById('modal').style.display = 'none';

    document.getElementById('confirm-btn').onclick = () => {
      const name = document.getElementById('claimer-name').value.trim();
      if (!name) return alert('Please enter your name ♡');

      if (!currentGift.isRedPocket) {
        currentGift.claimed = true;
        currentGift.claimedBy = name;
      }
      claimedHistory[currentGift.id] = name;
      saveToStorage();
      render();
      document.getElementById('modal').style.display = 'none';
      alert(`Thank you ${name} ♡ Your blessing has been recorded!`);
    };

    // Admin functions
    function openAdminPanel() {
      const pass = prompt("Admin password?", "");
      if (pass !== "0411") return alert("Wrong password!");
      const select = document.getElementById("gift-to-reset");
      select.innerHTML = '<option value="">-- Select gift to undo --</option>';
      Object.keys(claimedHistory).forEach(id => {
        const g = gifts.find(x => x.id == id);
        if (g) {
          const opt = new Option(`${g.name} — ${claimedHistory[id]}`, id);
          select.add(opt);
        }
      });
      if (select.options.length === 1) return alert("No gifts to undo yet!");
      document.getElementById("admin-modal").style.display = "flex";
    }

    function performReset() {
      if (document.getElementById("admin-pass").value !== "0411") return alert("Wrong password!");
      const id = document.getElementById("gift-to-reset").value;
      if (!id) return alert("Please select a gift");
      delete claimedHistory[id];
      const g = gifts.find(x => x.id == id);
      if (g && !g.isRedPocket) { g.claimed = false; g.claimedBy = ""; }
      saveToStorage();
      render();
      alert("Gift undone successfully!");
      document.getElementById("admin-modal").style.display = "none";
    }

    window.onclick = e => {
      if (e.target.classList.contains('modal')) e.target.style.display = 'none';
    }
  </script>
</body>
</html>
