<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hannah & Victor 22.11.2025</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      background: linear-gradient(to bottom, #fffaf0, #fdf2e9); 
      margin:0; padding:0; min-height:100vh; 
    }
    .container { max-width: 100%; margin: 0 auto; padding: 20px 15px; }
    h1 { text-align:center; color:#c0392b; font-size:28px; margin:20px 0 8px; font-weight:600; }
    .date { text-align:center; color:#e74c3c; font-size:19px; margin-bottom:25px; letter-spacing:1px; }

    .thanks {
      background:#fff; padding:22px; border-radius:18px; box-shadow:0 10px 30px rgba(0,0,0,0.08);
      margin:20px 0; text-align:center; line-height:1.9; font-size:16px; color:#2c3e50;
    }
    .thanks strong { color:#c0392b; font-size:19px; }

    .gift { 
      border-radius:18px; padding:18px; margin:18px 0; display:flex; align-items:center;
      background:#fff; box-shadow:0 8px 25px rgba(0,0,0,0.09); transition:all 0.2s;
    }
    .gift:active { transform:scale(0.98); }
    .gift img { 
      width:96px; height:96px; object-fit:cover; border-radius:15px; margin-right:16px; 
      flex-shrink:0; background:#f0f0f0;
    }
    .gift .info { flex:1; }
    .gift .price { font-weight:bold; color:#27ae60; font-size:19px; }
    .gift button { 
      background:#e74c3c; color:white; border:none; padding:13px 24px; 
      border-radius:50px; cursor:pointer; font-size:15px; font-weight:500; min-width:120px;
    }
    .gift button:active { background:#c0392b; }

    .redpocket { border: 3px solid #e74c3c !important; background: linear-gradient(135deg, #fff9f9, #fff3f3) !important; }

    /* MODAL - Mobile Optimized */
    .modal { 
      padding:15px; overflow-y:auto; -webkit-overflow-scrolling:touch;
    }
    .modal-content { 
      border-radius:22px; padding:28px 22px; max-width:90%; margin:auto; 
      background:#fff; box-shadow:0 15px 40px rgba(0,0,0,0.15); 
      max-height:90vh; overflow-y:auto; -webkit-overflow-scrolling:touch;
    }
    .close { float:right; font-size:28px; cursor:pointer; color:#aaa; }

    /* Step 1: Details */
    #step-details { text-align:center; }
    #step-details img { width:100px; height:100px; object-fit:cover; border-radius:15px; margin-bottom:15px; }
    #step-details h3 { margin:12px 0 8px; font-size:20px; }
    #step-details p { color:#555; margin:12px 0; line-height:1.7; font-size:15px; }
    #proceed-btn { background:#e74c3c; color:white; padding:16px; border-radius:50px; font-size:17px; width:100%; margin-top:20px; border:none; }

    /* Step 2: Payment */
    #step-payment { display:none; text-align:center; }
    .payment-btns { display:flex; gap:15px; margin:20px 0; }
    .btn-fps, .btn-payme { 
      flex:1; padding:16px; border-radius:50px; font-size:16px; border:none; color:white; font-weight:600;
    }
    .btn-fps { background:#1e90ff; }
    .btn-payme { background:#e74c3c; }
    .qr-container { margin:20px 0; }
    .qr { width:240px; margin:0 auto; border:10px solid #fff; border-radius:18px; box-shadow:0 6px 25px rgba(0,0,0,0.15); display:none; }
    .qr.active { display:block; animation:fadeIn 0.3s; }
    @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

    /* Inputs */
    .input-group { margin:18px 0; }
    .input-group input, .input-group textarea {
      width:100%; padding:16px; border-radius:50px; border:1px solid #ddd; 
      font-size:17px; text-align:center; resize:none;
    }
    .input-group textarea { height:100px; border:50px; }

    #confirm-btn { background:#27ae60; color:white; padding:16px; border-radius:50px; font-size:17px; width:100%; border:none; margin-top:15px; }

    .admin-btn { margin:70px auto 40px; text-align:center; }
    .admin-btn button { background:#2c3e50; padding:11px 18px; border-radius:50px; font-size:12px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Hannah & Victor</h1>
    <div class="date">22 November 2025</div>

    <div class="thanks">
      <strong>親愛的家人朋友，</strong><br><br>
      感謝你們來到我們人生中最重要的一天！有你哋在場已經係最好嘅禮物～<br><br>
      Your presence is the greatest blessing. 如果你哋想再送上祝福，<br>
      以下係我哋用心準備嘅禮物清單同利是選項，隨心選擇即可<br><br>
      多謝你哋嘅愛心同支持，真係好感動！感恩有你哋！
    </div>

    <h2 style="color:#e74c3c; text-align:center; margin:40px 0 20px;">Available Gifts 可選禮物</h2>
    <div id="available"></div>

    <h2 style="color:#27ae60; text-align:center; margin:50px 0 20px;">Already Gifted 已送出嘅祝福</h2>
    <div id="gifted"></div>

    <!-- Claim Modal -->
    <div id="modal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">×</span>

        <!-- STEP 1: Gift Details -->
        <div id="step-details">
          <img id="modal-img" src="" alt="" />
          <h3 id="modal-name"></h3>
          <p id="modal-details" style="white-space:pre-line;"></p>
          <p style="font-size:21px; color:#27ae60; margin:15px 0;">
 Fritz<span id="modal-price"></span>
          </p>
          <button id="proceed-btn" onclick="showPaymentStep()">Proceed to Pay</button>
        </div>

        <!-- STEP 2: Payment + Form -->
        <div id="step-payment">
          <div class="payment-btns">
            <button class="btn-fps" onclick="toggleQR('fps')">FPS</button>
            <button class="btn-payme" onclick="toggleQR('payme')">PayMe</button>
          </div>

          <div class="qr-container">
            <img id="qr-fps" src="images/qr-fps.png" alt="FPS" class="qr" />
            <img id="qr-payme" src="images/qr-payme.png" alt="PayMe" class="qr" />
          </div>

          <div class="input-group">
            <input type="text" id="claimer-name" placeholder="Your name 你的名字" required />
          </div>
          <div class="input-group">
            <textarea id="blessing" placeholder="Leave a blessing (optional) 送上祝福（可選）"></textarea>
          </div>

          <button id="confirm-btn" onclick="confirmGift()">I've Paid – Record My Gift</button>
          <button onclick="backToDetails()" style="margin-top:10px; background:#95a5a6; color:white; padding:14px; border-radius:50px; width:100%; border:none; font-size:16px;">
            ← Back
          </button>
        </div>
      </div>
    </div>

    <!-- Admin Button -->
    <div class="admin-btn">
      <button onclick="openAdminPanel()">Undo a gift (admin only)</button>
    </div>

    <!-- Admin Modal -->
    <div id="admin-modal" class="modal" style="display:none;">
      <div class="modal-content" style="max-width:400px;">
        <h3 style="color:#c0392b;">Admin: Undo Gift</h3>
        <p>Password:</p>
        <input type="password" id="admin-pass" placeholder="Enter password" style="width:100%; padding:12px; border-radius:50px; text-align:center;" />
        <p>Select gift to undo:</p>
        <select id="gift-to-reset" style="width:100%; padding:12px; margin:15px 0; border-radius:50px;"></select>
        <div style="margin-top:20px;">
          <button onclick="performReset()" style="background:#27ae60; padding:12px 24px; border-radius:50px;">Confirm Undo</button>
          <button onclick="document.getElementById('admin-modal').style.display='none'" style="margin-left:10px; background:#95a5a6; padding:12px 20px; border-radius:50px;">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    let currentGift = null;
    let selectedPayment = null;

    function openModal(id) {
      currentGift = gifts.find(g => g.id === id);
      if (!currentGift || (!currentGift.isRedPocket && currentGift.claimed)) return;

      // Reset modal
      document.getElementById('step-details').style.display = 'block';
      document.getElementById('step-payment').style.display = 'none';
      document.querySelectorAll('.qr').forEach(q => q.classList.remove('active'));
      document.getElementById('claimer-name').value = '';
      document.getElementById('blessing').value = '';

      // Fill details
      document.getElementById('modal-img').src = currentGift.photo;
      document.getElementById('modal-name').textContent = currentGift.name;
      document.getElementById('modal-price').textContent = 
        currentGift.isRedPocket ? 'Any amount 隨意金額' : 'HK$ ' + currentGift.price;
      document.getElementById('modal-details').textContent = currentGift.details || "Thank you for your love!";

      document.getElementById('modal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('modal').style.display = 'none';
    }

    function showPaymentStep() {
      document.getElementById('step-details').style.display = 'none';
      document.getElementById('step-payment').style.display = 'block';
    }

    function backToDetails() {
      document.getElementById('step-payment').style.display = 'none';
      document.getElementById('step-details').style.display = 'block';
    }

    function toggleQR(type) {
      const qr = document.getElementById('qr-' + type);
      const isActive = qr.classList.contains('active');
      
      document.querySelectorAll('.qr').forEach(q => q.classList.remove('active'));
      if (!isActive) {
        qr.classList.add('active');
        selectedPayment = type;
      } else {
        selectedPayment = null;
      }
    }

    function confirmGift() {
      const name = document.getElementById('claimer-name').value.trim();
      const blessing = document.getElementById('blessing').value.trim();

      if (!name) return alert('Please enter your name');
      if (!selectedPayment) return alert('Please select FPS or PayMe');

      const db = firebase.database();
      const data = { name, blessing, payment: selectedPayment, timestamp: Date.now() };
      db.ref('weddingGifts/' + currentGift.id).set(data)
        .then(() => {
          alert(`Thank you ${name}! Your gift is recorded.`);
          closeModal();
        })
        .catch(() => alert('Network error, try again'));
    }

    // Close on outside click
    window.onclick = e => {
      const modal = document.getElementById('modal');
      const admin = document.getElementById('admin-modal');
      if (e.target === modal) closeModal();
      if (e.target === admin) admin.style.display = 'none';
    }
  </script>
</body>
</html>